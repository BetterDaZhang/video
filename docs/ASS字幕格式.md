## ASS字幕格式规范

## 0. 前言

Sub Station Alpha 本身是一个 Windows 平台下制作 SSA 格式字幕的软件，该软件已经不再开发了，而它所创造的 SSA 格式却流行开来，并演化出了更先进的 ASS 格式。

[ASS specs](http://moodub.free.fr/video/ass-specs.doc) 文档可能比较偏向于在使用 Sub Station Alpha 软件时 SSA 格式的规范，比较局限于其软件本身和 Windows 平台。随着 [Aegisub](http://www.aegisub.org/) 等跨平台的字幕编辑软件出现，以及在网页上渲染字幕的需求，我们应摒弃那些局限于软件和平台的规范，专注于字幕格式本身的规范。

目前 ASS 字幕制作人员所看到的效果绝大多数都是由 [xy-VSFilter](https://code.google.com/p/xy-vsfilter/) 和 [libass](https://github.com/libass/libass) 渲染的，于是这两个渲染器就成了事实上的标准。

本文档主要是对 ASS specs 的翻译，另外增加了一些规范中没有写但实际有应用的语法说明，以及我在写 ASS.js 的过程中对其的个人理解和注释（在下文中使用*斜体*表示）。

>**SubStation Alpha**（或 **Sub Station Alpha**），简称**SSA**，是由 CS Low（亦作 Kotus）创建、比传统字幕（如[SRT](https://zh.wikipedia.org/wiki/%E5%AD%97%E5%B9%95%E6%A0%BC%E5%BC%8F#SRT.E6.A0.BC.E5.BC.8F)）更加强大先进的字幕文件格式。该格式在[Windows](https://zh.wikipedia.org/wiki/Windows)平台上可以经播放器由VSFilter渲染进行播放。这是一款广受欢迎且已停止开发的字幕编辑制作工具。
>
>而**Advanced SubStation Alpha**（**ASS**）是一种比SSA更先进的字幕脚本格式。基于SSA 4.00+编码构建。ASS的主要变化就是在SSA编写风格的基础上增添更多的效果和指令。
>
>该字幕格式常被[字幕组](https://zh.wikipedia.org/wiki/%E5%AD%97%E5%B9%95%E7%B5%84)所应用，分为**内挂字幕**、**外挂字幕**和**内嵌字幕**三种形式。内挂字幕一般指字幕文件与视频一同封装在[MKV](https://zh.wikipedia.org/wiki/MKV)文件中，播放时需经过[VSFilter](https://zh.wikipedia.org/wiki/VSFilter)渲染。外挂字幕指字幕文件以单独形式存在，播放时经VSFilter渲染到视频上。内、外挂字幕又称软字幕，是可以提取、取出和查看源代码的。而内嵌字幕则是指字幕被以图形方式硬编码到视频中，所以播放时不需VSFilter等渲染，一般来说，该过程不可逆。

## 1. 总体信息

对 ASS 字幕的基本介绍请参阅[维基百科](https://en.wikipedia.org/wiki/SubStation_Alpha)。

1. SSA v4.00 的格式与 SSA 之前版本的格式不同。

   SSA v4.00 可以识别旧版本的脚本，但旧版本不能正确地加载 v4.00 脚本。
   脚本格式中的某些改变是为了允许 SSA v4.00 及以上的所有版本可以识别所有现存的和将来的 SSA 脚本。例如，新的「Format」字段允许 SSA 只读取它所能识别的并忽略未来可能加入的新的信息。

2. 脚本是纯文本文件。
   这意味着它们可以用任何文本编辑器手工地编辑，但必须要注意：SSA 假定脚本是遵循本文档中的规则，在解析时任何错误都可能会导致无法预料的结果。

3. 脚本被划分为 [ini](https://en.wikipedia.org/wiki/INI_file) 文件风格的多个部分。
   然而，SSA 脚本并不是真正的 Windows .ini 文件，你不能像用 ini 文件一样用它。

4. 各个部分中的绝大多数行以一个「行描述符」加上冒号开头，以指明它包含了什么信息。

5. 每行中的信息字段以逗号分隔。
   于是在角色名和样式名中使用逗号是非法的（SSA 会阻止你这么做）。这也使得将 SSA 脚本作为一个 [CSV](https://en.wikipedia.org/wiki/Comma-separated_values) 文件把块导入到表格变得简单，同时砍掉在其他字幕节目中要用到的列信息。

6. 事件部分（`[Events]`）各行排列不分先后。
   它们可以以完全相反的顺序排列，SSA 会将它们按正确的顺序播放。即，你不能假定脚本文件中的每条对话行是按时间顺序排列的。
   *如果两条对话的开始时间相同，那么会根据在脚本中的排列顺序显示到屏幕上。*

7. 不正确格式的行会被忽略。
   SSA 会丢弃任何它不能识别的行，同时在解析完后给出警告指明被忽略的行数。

8. 行不能被分割。
   脚本中每个条目在单行中包含了它的完整信息。

9. 如果在脚本中使用了一个未知的样式，将会使用默认的 `*Default` 样式。
   例如，如果从另一个脚本复制了一些行而没有复制对应的样式信息，那么就会使用默认样式。

10. 当一个风格中指定了系统没有安装的字体，会用 `Arial` 字体代替。

## 2. SSA 脚本的各个部分

### `[Script Info]`

这一部分包含了脚本的头部和总体信息。`[Script Info]` 必须是 v4 版本脚本的第一行。

### `[v4 Styles]`

这一部分包含了所有样式的定义。每一个被脚本使用的样式都应该在这里定义。ASS 使用 `[v4+ Styles]`。

### `[Events]`

这一部分包含了所有脚本的事件，有字幕、注释、图片、声音、影像和命令。基本上，所有在屏幕上看到的内容都在这一部分。

### `[Fonts]`

这一部分包含了脚本中内嵌字体的信息。

### `[Graphics]`

这一部分包含了脚本中内嵌图片的信息。

## 3. `[Script Info]` 详解

`;`
分号，后面可以跟任何内容。只在脚本中用作注释。加载脚本时不可见。分号必须是该行的第一个字符。旧版本中使用 `!:` 注释。

`Title`
标题，对脚本的描述。如果未指定，自动设置为 `<untitled>`。

`Original Script`
最初创建脚本的作者。如果未指定，自动设置为 `<unknown>`。

`Original Translation`
（可选）最初翻译对话的人。如果未指定，该项不显示。

`Original Editing`
（可选）最初脚本的编辑者，通常是对翻译润色和校对的人。如果未指定，该项不显示。

`Original Timing`
（可选）最初的时间轴人员。如果未指定，该项不显示。

`Synch Point`
（可选）指明什么时候脚本应该开始播放。如果未指定，该项不显示。

`Script Updated By`
（可选）对原脚本进行更新的其他字幕团体的人。如果未指定，该项不显示。

`Update Details`
（可选）其他字幕团体对原脚本更新的细节。如果未指定，该项不显示。

`ScriptType`
SSA 脚本格式的版本。例如 `V4.00`。如果当前使用的 SSA 程序版本旧于脚本的版本，将给出警告。

`Collisions`
为了防止字幕重叠，它决定了字幕如何移动。
如果设置为 `Normal`，SSA 将尝试使用「Margins」指定的位置来定位字幕。同时，字幕会垂直地移动来防止重叠。在 `Normal` 的防重叠模式下，新字幕会出现在已存在字幕的上方，但它会寻找最低的不产生重叠的位置，来填补其他字幕产生的「空隙」。
如果设置为 `Reverse`，已存在的字幕会上移给新字幕腾出空间。这意味这字幕总是可以自上向下地阅读，但也意味着已存在的字幕可能会在新字幕出现之前出现在屏幕的中间。它会占用大量的屏幕区域。

`PlayResY`
渲染字幕时的渲染范围的高度。如果使用 Directdraw 播放，SSA v4 会自动选择最接近的已启用的设置。

`PlayResX`
渲染字幕时的渲染范围的宽度。如果使用 Directdraw 播放，SSA v4 会自动选择最接近的已启用的设置。

`PlayDepth`
渲染字幕时的颜色深度。如果使用 Directdraw 播放，SSA v4 会自动选择最接近的已启用的设置。

`Timer`
脚本的计时器速度，为百分数。例如，`100.0000` 代表 100%，保留四位小数。
计时器速度是应用于 SSA 时钟的时间乘数，以提供斜坡时间来扩展或压缩脚本的总时间。速度大于 100% 会减少脚本总时间，意味着字幕会逐步地越来越早地出现；速度小于 100% 会增加脚本总时间，意味着字幕会逐步地越来越晚地出现（就像一个正的斜坡时间）。
扩展和压缩只发生在脚本播放时，这个值不会改变脚本事件部分的实际时间。
阅读 SSA 用户指南来了解为什么「计时器速度」比「斜坡时间」更好，尽管他们实现了相同的结果。
*我也不知道这是什么鬼，也没找到什么 SSA 用户指南，从实际的效果来看，大概是把字幕的开始时间和结束时间乘一个百分数，比如设置为 200.0000 时就是两倍速度播放字幕。*

`WrapStyle`
定义了默认的换行方式。

- `0`：智能换行，分割比较均匀，上面的行较长。
- `1`：从行尾的词换行，只有 `\N` 能强制换行。
- `2`：不换行，`\n` 和 `\N` 强制换行。
- `3`：和 `0` 一样智能换行，下面的行较长。

`ScaledBorderAndShadow`
指定边框宽度与阴影深度是否随着视频分辨率等比例缩放，默认为 `No`。
当值为 `No` 时，边框宽度与阴影深度完全按照指定的像素数显示；当值为 `Yes` 时，边框宽度与阴影深度随着实际视频的分辨率同等比例缩放。

## 4. `[v4 Styles]` 详解

Styles 定义了字幕的外貌和定位。
ASS 格式应当使用 `[v4+ Styles]`。

`Format`
定义了 `Style` 行中每一个字段所代表的含义。`Format` 行必须出现在所有 `Style` 行之前，因为它决定了 SSA 如何来解析 `Style` 行。`Format` 行所列出的字段必须正确拼写。字段名如下：

```
Name, Fontname, Fontsize, PrimaryColour, SecondaryColour, TertiaryColour, BackColour, Bold, Italic, Underline, StrikeOut, ScaleX, ScaleY, Spacing, Angle, BorderStyle, Outline, Shadow, Alignment, MarginL, MarginR, MarginV, AlphaLevel, Encoding
```

`Format` 行允许未来的脚本格式中添加新的字段，也允许旧版本的软件读出它所能识别的字段，即便字段的顺序发生了变化。

`Style`
样式的定义，用于格式化脚本显示的文本。
每一个被脚本使用的样式都应该被定义为 `Style` 行。

······



















