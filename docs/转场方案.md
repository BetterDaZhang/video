## 转场前端技术方案

使用两个canvas+两个video标签实现

Video1: 播放中的视频

Video2: 该片段的下一片段的视频

Canvas1: 负责绘制模拟播放的数据，绘制源在两个视频间切换。

Canvas2: 拿到Canvas1中的像素数据进行逐像素处理，生成转场后的画面。  

下图为video和canvas宽高均为320*180 => canvas只能画出相应分辨率的视频

​	

![](http://p1yseh5av.bkt.clouddn.com/18-4-28/69851052.jpg)

1. 两个视频片段之间连贯播放

   - 使用3个video标签。

     a、缓存上一个视频

     b、播放本段视频

     c、加载下一段即将播放的视频。

   - 使用低清晰度视频源

     wevideo的视频源

     ```
     #EXTM3U
     #EXT-X-STREAM-INF:BANDWIDTH=585000,RESOLUTION=480x270
     http://wevideo-proxy-videos.s3.amazonaws.com/2018_03_22_8d934343-8e1d-49ea-88a8-89603347b351_parts.m3u8
     ```

     平均加载时间2s，我们加载时间12s

2. 转场

   第一版：

   采用canvas 2D绘图方式

   将视频元素拷贝到canvas中，意味着开启了操作视频帧的能力。

   [ 播放视频 ] => [ 将视频画到canvas1中 ] => [ 将canvas1切片并画到canvas2中 ]

   - 将像素数据从video标签中复制出来的代价是很高的，因此先将视频画到一个临时的canvas中。

   第二版：

   使用webgl转场

   附件：webgl.zip





前端开发排期

| 内容                                | 排期 | 备注      |
| ----------------------------------- | ---- | --------- |
| 前期调研，问题排查                  | 1天  | 5.23      |
| webgl转场环境搭建及转场效果开发调试 | 3天  | 5.24-5.28 |
| 叠化效果片段判断和时间线调整        | 1天  | 5.29      |
| 联调自测                            | 1天  | 5.30      |







