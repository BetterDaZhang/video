## 音频编码

### 1. 相关概念

#### 1.1 声音

​	声音是一种物理现象。物体振动时产生声波通过空气传到人们的耳膜经过大脑的反射被感知为声音。

​	声音有频率和[振幅](https://link.jianshu.com/?t=http://baike.baidu.com/view/29246.htm)的特征，频率对应于时间轴线，振幅对应于电平轴线。

​	声音以波的形式振动（震动）传播，声音作为一种波，频率在20 Hz~20 kHz之间的声音是可以被人耳识别的。

![](http://p1yseh5av.bkt.clouddn.com/18-1-8/83024328.jpg)

音的高低：是由于物体在一定时间内的振动次数频率而决定的。振动次数多音则高，振动次数少音则低。
音的长短：是由于音的延续时间的不同而决定的，音的延续时间长音则长，音的延续时间短音则短。
音的强弱：是由于振幅音的振动的幅度的大小决定的。振幅大音则强振幅小音则弱。
音色：即声音的特色是由发声体的材料、结构以及泛音的多少决定的。

按照频率分类：
频率低于20Hz的声波称为次声波；
频率在 20Hz~20kHz的声波称为可闻声；
频率在 20kHz~1GHz的声波称为超声波；
频率大于1GHz的声波称为特超声或微波超声。



#### 1.2 从模拟录音到数字录音

​	谈到录音，不得不谈到爱迪生发明的现代录音设备的鼻祖：留声机。

​	留音机 最初是1877年伟大的世界发明大王爱迪生发明的，在一次调试话筒时因为听力不好，爱迪生用一根针来检验传话膜的震动，不料针接触到话膜后随着声音的强弱变化产生一种有规律的颤动，而这一现象就成了他发明的灵感。
​	因为我们都知道，发送和接受是两个相对应的过程。说话的快慢高低能使短针发生相应的不同颤动，那么反过来，这种颤动也能发出原来的说话声音，可以将声波变换成金属针的震动，然后将波形刻录在圆筒形腊管的锡箔上。当针再一次沿着刻录的轨迹行进时，便可以重新发出留下的声音。于是他就用这一原理制作出了他的第一台留音机。
​	随着历史的发展慢慢经过了 ：

​	机械录音（以留声机、机械唱片为代表）----- 光学录音（以电影胶片为代表）-----  磁性录音（以磁带录音为代表）等模拟录音方式，直到二十世纪七、八十年代逐渐开始进入了数字录音（数字音频）的时代。

#### 1.3 数字音频

**什么是音频？**
音频（Audio）指人能听到的声音包括语音、音乐和其它声音如环境声、音效声、自然声等。

**为什么要存在数字音频 ？**
由物理学可知，**复杂的声波**由许许多多具有不同振幅和频率的正弦波组成。代表声音的模拟信息是个连续的量，不能由计算机直接处理，必须将其数字化。
经过数字化处理之后的数字声音信息能够像文字和图形信息一样进行存储、检索、编辑和其它处理。

**什么是数字音频？**
数字音频是指使用数字编码的方式也就是使用0和1来记录音频信息，它是相对于模拟音频来说的。

> 模拟音频的记录就是通过唱片（LP）表面的起伏跌宕（当然细小到你很难看见，而且并非是表面纹路形成的沟痕的底部，因为底部容易积灰——事实上这些跌宕起伏是存在于纹路的两侧）或者是磁带上的磁粉引起的磁场强度来表示音箱上振膜的即时位置，比如说，当唱片表面在某一时刻比前一时刻的纹路呈下降趋势时，音箱上的振膜就会向里收缩；如果呈上升趋势，音箱上的振膜就会向外舒张。
>
> 在CD光盘和计算机技术未出现之前都是模拟音频（如录音带），其中数字/模拟转换器简称：DAC、模拟/数字转换器简称：ADC.

**模拟音频与数字音频的区别就是连续信号与离散信号的区别。**连续信号的特点是连续，比如唱片，比如磁带，磁带在播放时磁带的移动是连续水平移动的，唱机的唱针在唱片上运动时是连续变化的。这意味着信号不会失真，但是保存这样的介质就会非常困难，比如说唱片会磨损，磁带也会老化.

**那么如何将模拟音频转化为数字音频？** 

类似于丈量土地的办法，由于连续的信号理论上来讲其信息量是无穷的，那么人们就通过采样的办法，例如，将磁带上每隔一段距离**（采样）**，就记录下该处的磁场强度**（量化）**，或者当唱针相对唱片每走过相同的一段距离**（采样）**，就测量一下此时唱针的高度**（量化）**。经过这样的处理，我们就得到了各个时刻所对应的一些数值，然后用这些数值来当做原本唱片的信息。就这样，我们就完成了模拟信号——数字信号，或者说是模拟音频——数字音频的转换。  

我们知道声音可以表达成一种随着时间的推移形成的一种波形：

![](http://p1yseh5av.bkt.clouddn.com/18-1-8/21351382.jpg)

![](http://p1yseh5av.bkt.clouddn.com/18-1-8/94337989.jpg)

每隔一个小小的时间间隔，去用尺子量一下这个点的位置在哪里。

那么只要这个间隔是一定的,我们就可以把这个曲线描述成：{9,11,12,13,14,14,15,15,15,14,14,13,12,10,9,7...}

然后我们可以把这些[电平信号](https://link.jianshu.com/?t=http://baike.baidu.com/view/1573140.htm)转化成[二进制](https://link.jianshu.com/?t=http://baike.baidu.com/subview/18536/18536.htm)数据保存，播放的时候就把这些数据转换为模拟的电平信号再送到喇叭播出，就可以了。

用专业的术语来说，我们每两次测一下位置的时间间隔，就是所谓的**采样率**。采样率等于多少，就意味着我们每秒钟进行了多少次这样的测量。所谓音质，就是指最后我们描述这个曲线的数字，到底和真实的曲线误差有多大。

[数字声音](https://link.jianshu.com/?t=http://baike.baidu.com/view/1461204.htm)和一般磁带、广播、电视中的声音就存储播放方式而言有着本质区别。相比而言，它具有存储方便、存储成本低廉、存储和传输的过程中没有声音的失真、编辑和处理非常方便等特点。

#### 1.4 从“模拟信号”到“数字化”

模拟信号到数字化的过程需要三个步骤：

![](http://p1yseh5av.bkt.clouddn.com/18-1-8/98357848.jpg)

（1）采样：

所谓采样，即以适当的时间间隔观测模拟信号波形不连续的样本值替换原来的连续信号波形的操作，又称为取样。
采样的过程就是抽取某点的频率值，很显然，在一秒中内抽取的点越多，获取得频率信息更丰富。
采样的基本定理：为了复原波形，一次振动中，必须有2个点的采样，人耳能够感觉到的最高频率为20kHz，因此要满足人耳的听觉要求，则需要至少每秒进行40k次采样。

（2）量化：

在数字音频技术中，把表示声音强弱的模拟电压用数字表示，如0.5V电压用数字20表示，2V电压是80表示。模拟电压的幅度，即使在某电平范围内，仍然可以有无穷多个，如1.2V,1.21V,1.215V…。而用数字来表示音频幅度时，只能把无穷多个电压幅度用有限个数字表示。即把某一幅度范围内的电压用一个数字表示，这称之为量化。

![](http://p1yseh5av.bkt.clouddn.com/18-1-8/85617174.jpg)



（3）编码: 
​	计算机内的基本数制是二进制，为此我们也要把声音数据写成计算机的数据格式，这称之为编码。

![](http://p1yseh5av.bkt.clouddn.com/18-1-8/39346983.jpg)

#### 1.5 数字音频的分类

**数字音频主要包括两类：波形音频 和 MIDI音频：**

**波形音频：**
波形音频文件是通过声音录入设备录制的原始声音，直接记录了原始真实声音信息的数据文件，通常文件较大。

**MIDI音频：**

译作乐器数字化接口，是为了把电子乐器与计算机相连而制定的一个规范，是数字音乐的国际标准。 数字式电子乐器的出现，为计算机处理音乐创造了极为有利的条件。MIDI声音与数字化波形声音完全不同，它不是对声波进行采样、量化和编码，而是将电子乐器键盘的弹奏信息记录下来，包括键名、力度、时值长短等，这些信息称之为MIDI消息，是乐谱的一种数字式描述。当需要播放时，只需从相应的MIDI文件中读出MIDI消息，生成所需要的乐器声音波形，经放大后由扬声器输出。



###  2. 音频帧

正常人听觉的频率范围大约在20Hz~20kHz之间。

采样频率是指将模拟声音波形进行数字化时，每秒钟抽取声波幅度样本的次数。

根据奈奎斯特采样理论，为了保证声音不失真，采样频率应该在**40kHz**左右。

> 奈魁斯特（NYQUIST）采样定理是？
>
> 用2倍于一个正弦波的频率进行采样就能完全真实地还原该波形，因此一个数码录音波的采样频率的取值直接关系到它的最高还原频率指标。
>
> 例如用44.1KHZ的采样频率进行采样，则可还原为最高22.05KHZ的频率——这个数值略高于人耳的听觉极限。

常用的音频采样频率有8kHz、11.025kHz、22.05kHz、16kHz、37.8kHz、44.1kHz、48kHz等，

如果采用更高的采样频率，还可以达到DVD的音质。

对采样率为44.1kHz的AAC音频进行解码时，一帧的解码时间须控制在23.22毫秒内。

通常是按1024个采样点一帧

分析：

1. **AAC**

一个AAC原始帧包含某段时间内1024个采样点相关数据。

用1024主要是因为AAC是用的1024点的mdct。

音频帧的播放时间 = 一个AAC帧对应的采样样本的个数 / 采样频率(单位为s)。

采样率(samplerate)为 44100Hz，表示每秒 44100个采样点, 

所以，根据公式,   

音频帧的播放时长 = 一个AAC帧对应的采样点个数 / 采样频率

则，当前一帧的播放时间 = 1024 * 1000000/44100= 22.32ms(单位为ms)

48kHz采样率，

则，当前一帧的播放时间 = 1024 * 1000000/48000= 21.32ms(单位为ms)

22.05kHz采样率，

则，当前一帧的播放时间 = 1024 * 1000000/22050= 46.43ms(单位为ms)

2. **MP3** 

mp3 每帧均为1152个字节， 

则：

每帧播放时长 = 1152 * 1000000 / sample_rate

例如：sample_rate = 44100HZ时， 

计算出的时长为26.122ms，

这就是经常听到的mp3每帧播放时间固定为26ms的由来。



### 来源

[音频帧概念详解](http://blog.csdn.net/fireroll/article/details/8623989)

[将模拟音频向数字音频的转换过程是怎样的？](https://www.zhihu.com/question/19829823)