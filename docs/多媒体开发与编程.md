# 多媒体开发与编程

主编 于永彦 关明山等

北京大学出版社 



## 第一章 绪论

### 1.1 媒体概述

计算机行业的媒体有两层含义：一是指存储信息的载体，如磁盘、光盘、闪盘等；二是指传播信息的载体，如文字、声音、图形/图像、视频、动画等。

媒体的5个层面

| 名称     | 作用                                                         |
| -------- | ------------------------------------------------------------ |
| 感知媒体 | 由人类感官直接感知的一类媒体                                 |
| 表达媒体 | 为了能更有效地加工、处理和传输感觉媒体而人为构造出来的一种媒体 |
| 显示媒体 | 进行信息输入和输出的媒体                                     |
| 存储媒体 | 进行信息存储的媒体                                           |
| 传输媒体 | 用于承载信息、传输信息的载体                                 |

其中，表达媒体又可以分为三种类型：视觉类媒体（位图图像、矢量图形、图表、符号、视频、动画）、听觉类媒体（音响、语音、音乐）、触觉类媒体（点、未知追踪；力反馈和运动反馈）。视觉和听觉类媒体是信息传播的内容，触觉类媒体是实现人机交互的手段。

#### 常见媒体

- 文本

  是最基本、最成熟的一种媒体形式，由字符型数据和汉字组成，在计算机中用二进制编码的形式表示。

  常见的编码是美国标准信息交换码（American Standard Code for Information Interchange，ASCII），它主要针对西文字符。

  我国的汉字字符也有对应的二进制编码，称为汉字国标码。我国汉字标准GB2312中有6763个常用汉字。

- 音频

  音频（Audio）是个专业术语，泛指人类能够听到的所有声音。

  人的耳朵对于声音的感知频率范围约为20Hz～20kHz。

  音调、音强和音色称为声音的三要素。

  其中，音调与声音的频率相关，频率高则音调高，频率低则音调低。

  音强取决于声波的幅度，振幅高时音强强，振幅低时音强弱。

  音色则由叠加在声音基波上的谐波所决定，一个声波上的谐波越丰富，音色越好。

  多媒体技术设计声音处理的多个方面，如声音采集、编码/解码、合成/分解、语音识别等，其中最关键的是数字音频概念，数字音频是指一个用来表示声音强弱的数据序列，由模拟声音经抽样、量化和编码后得到。常见的数字CD等中存储的都是数字音频数据。

- 图形与图像

  图形：指由点、线、面、体等几何要素明暗、灰度、色彩等非几何要素构成的，从现实世界中抽象出来的带有灰度、色彩和形状的图或形。

  图像：指当光辐射能量

  图像是由一些排列的像素组成的，故也称为位图。图像一般数据量较大。

  图形最大的特点是容易进行移动、压缩、旋转、扭曲等变换，主要用于表示线框图的图画、工程制图、美术字等。

  由于图形只保存算法和特征点，所以相对于图像的大量数据来说，图形占用的存储空间较小。但由于每次屏幕显示时都需要重新计算，故**显示速度没有图像快**。

  另外，在打印输出和放大时，**图形的质量较高而图像常会发生失真**。

  svg属于图形，img属于图像。

- 视频

  通常所说的视频，一般泛指将一系列静态影像以电信号方式加以捕捉、记录、处理、储存、传送与重现的相关技术。

  视频的生成原理十分简单直观，例如，将若干张有联系的图像按一定的频率连续播放，当连续的图像变化超过24帧/秒以上时，根据视觉的暂留原理，人眼无法辨别单幅的静态画面，看上去是平滑连续的视觉效果，这样就形成了视频。

- 动画

  简单地说，所谓动画（Animation）就是运行的图画。

### 1.2 多媒体与多媒体技术

广义上来讲，所谓多媒体（Multimedia），就是指多种媒体的有机融合，即能够同时获取、处理、编辑、存储和回放两种或两种以上媒体的技术。它并不仅是指多种媒体本身，更主要的是指处理和应用多媒体的一整套技术。

- 多媒体概念

- 多媒体技术

- 多媒体技术的发展

  多媒体技术的反战是社会需求不断增加的结果，是社会分工不断细化的结果，是计算机技术不断成熟和扩展的结果。

  多媒体技术的起源得力于显卡和声卡的技术进步。显卡的诞生标志着计算机初具图像处理的能力；声卡的出现标志着计算机进一步具备了音频处理能力，直接推动计算机信息处理技术进入崭新的多媒体阶段。

  1984，美国RCA公司推出第一台雏形多媒体计算机。美国Apple公司开创了用计算机进行图像处理的先河，首次使用位图概念对图像进行描述，实现了对图像进行简单的处理、存储和传送等功能。

  ······

### 1.3 多媒体技术研究内容

多媒体技术从媒体的处理流程上看，可分为信息获取、处理与控制、数据传输3个方面，几乎覆盖了计算机技术的各个领域，包含信息数字化、压缩与编码、存储、传输、接口与通信等。

- 媒体信息的获取与展示

- 数据压缩、编码与存储

  衡量多媒体技术性能的基本指标是其对数据存储设备的要求和信息处理的效率。

  存储容量、存取速度和实时性。

  在采用新技术增加CPU处理速度、存储容量和提高通信带宽的同时，还需要研究高效的数据压缩和编码技术，以达到高效快速的存储及传输。

- 多媒体数据库技术

- 多媒体信息数据量巨大，媒体种类多，每种媒体之间的差别也很大，这些都给管理带来困难，因此，传统的数据库已不能适应多媒体数据的管理。多媒体数据库是一个由若干多媒体对象所构成的集合，这些数据对象按一定的方式被组织在一起，可为其他的应用所共享。多媒体数据库管理系统则负责完成对多媒体数据库的各种操作和管理功能，包括对数据库的定义、操纵和控制等这样一些传统数据库功能。

  多媒体内容检索···

- 多媒体通信技术

  多媒体系统一般都是基于网络分布的计算机应用系统。



## 第二章 Windows图形基础

多媒体的基本元素就是文本、声音、图形/图像和视频等。其实，从本质上来说，在Windows环境下，屏幕上显示的任何东西，包括文字信息，都可以看成是图形/图像，所以有时也把Windows称为图形操作系统。

### 2.1 图形概念

在计算机中，一般用矢量图来表达图形，而用位图描述图像。

- 矢量图

  所谓矢量图，是指用一系列计算机指令来表示一幅图，如画点、画线、画圆等。这种方法实际上是以数学方法来描述一幅图，然后变成许许多多的数学表达式，再经过编程后，用语言来表达。

  | 格式 | 特点                                                         |
  | ---- | ------------------------------------------------------------ |
  | SVG  | 可缩放的矢量图格式，可任意放大图形，边缘清晰，文字在图像中保留可编辑和可搜寻的状态；没有字体限制，生成的文件很小，下载很快，适合用于设计高分辨率的Web图形界面。 |
  | EPS  | 跨平台的标准格式，主要用于矢量图像和光栅图像的存储。常用于印刷和打印。 |
  | SWF  | Flash专用格式，支持矢量和点阵图形，广泛用于网页设计、动画制作等领域 |
  | DOC  | 通用格式化文本格式                                           |

  矢量图有许多优点。例如，当需要管理每一小块图像时，矢量图法非常有效；目标图像的移动、缩放、旋转、复制、属性的改变也很容易做到。可以把相同的或类似的图当作图的构造块，并把它们存到图库中，这样不仅可以加速画的生成，而且可以见效矢量图文件的大小。

  然而，当图变得复杂时，计算机就要花费很长的时间去执行绘图命令。此外，对于一幅复杂的彩色照片，很难用数学来描述，因而不能用矢量图表示，要采用位图法表示。

- 位图

  它把一幅彩色图分成许许多多的像素，组成一个点阵矩阵，每个像素用若干个二进制位来指示该像素的颜色、亮度和属性。

  PSD，BMP，JPEG

  位图又可以分为与设备有关的位图DDB和与设备无关的位图DIB。

  DDB     要么在视频内存中，要么在系统内存中。

  DIB       可用来永久性保存图像

  位图文件占据的存储空间比较大。影响位图文件大小的因素主要有两个：图像分辨率和像素深度。分辨率越高，表示组成一幅图的像素越多，图像文件就越大；像素深度越深，表明表达单个像素颜色和亮度的位数越多。而矢量图文件的大小则主要取决于图的复杂程度。

### 2.2 图形设备接口

任何图形的显示输出都离不开GDI。使用GDI绘制的图形具有设备无关性，操作系统屏蔽了硬件设备的差异，用户编程时无需考虑特殊的硬件设置，因而在屏幕窗口内绘图与在打印机上绘图是相似的。

不过，GDI并不直接完成图形绘制工作，它提供一种独立于设备的仲裁机制，接收应用程序通过GDI函数发来的请求，经过翻译之后将这些请求传送给相应的设备驱动程序，再由设备驱动程序驱动相应的硬件设备。



## 第三章 基于OpenGL的图形绘制

在计算机发展初期，人们就开始从事计算机图形的开发，但直到20世纪80年代末，3D图形才开始发展，涌现出各种3D图形工具包，比较典型的是硅图（Silicon Graphics，SGI）公司开发的IRIS图形库。IRIS GL是一个工业标准的3D图形软件接口，功能强大，但可移植性不好。为此，SGI公司又在此基础上开发了开放图形库（Open GL）。由于OpenGL独立于具体的硬件环境和操作系统环境，任何厂商均可自由使用，这让它备受业界人士喜爱，因而被广泛应用于医疗、军事、工业制图、传媒业、教育、艺术造型等领域，俨然已成为高端图形处理领域的通用标准之一。

### 3.1 OpenGL概述

1992 OpenGL 1.0

1995 OpenGL 1.1

2009 OpenGL 3.2

- OpenGL功能

  OpenGL是一个开放的三维图形软件包，除了提供基本物体的绘制函数外，还可以实现平移、旋转、变比、镜像和投影等基本变换，以及设置颜色模式、光照材质、纹理映射、图像特效和双缓存动画等功能。

  OpenGL有以下5个基本功能。

  - 模型绘制

    OpenGL能够绘制点、线和多边形。

    应用这些基本图形，我们可以构造出几乎所有的三维模型。

    OpenGL通常用模型的多边形顶点来描述三维图形。

  - 模型渲染

    - 指定颜色模式

      RGBA模式，直接由RGB值来制定

      颜色表模式， 由颜色表中的一个颜色索引值来指定

    - 设置光照

      三维模型必须加上光照才能与客观物体更加相似。

      OpenGL提供了4种光：辐射光、环境光、镜面光和漫反射光，另外还可以指定模型表面的反射特性。

    - 添加纹理

      三维景物因缺少景物的具体细节而显得不够真实，为了更加逼真地表现三维景物，OpenGL提供了纹理映射功能。OpenGL提供一系列纹理映射函数，从而可以方便地把真实图像贴到景物的多边形上，可以绘制逼真的三维景观。

    - 增强图像效果

      OpenGL提供了一系列增强三维景观图像效果的函数，这些函数通过反走样、混合和雾化等增强图像效果，使线段更平滑，效果更接近于真实。

  - 模型观察

    **观察三维模型是通过一系列的坐标变换进行的**。

    模型的坐标变换使观察者能够在视点位置观察与视点相适应的三维模型景观。

  - 实时动画

    为了获得平滑的动画效果，OpenGL提供了**双缓存技术**，即**先在内存生成一幅图像，再把已经生成的图像从内存复制到屏幕上**。

  - 交互技术

- OpenGL特点

  - 卓越的跨平台性

  - 完善的可编程性

  - 独特的网络透明性

    它允许一个运行在工作站上的进程在本机或通过网络在远程工作站上显示图形。利用这种性质能够均衡各工作站的工作负荷，共同承担图形应用任务。

- OpenGL工作机理

  由于OpenGL独立于硬件，因此不提供与硬件相关的操作函数。

  用户必须从最基本的点、线、面等开始，逐步构造自己的3D模型。但OpenGL提供了针对3D物体的丰富的绘制方式，如网格线、消隐、阴影、纹理、大气环境及深度域等渲染功能。使用这些特殊处理方式，OpenGL能够模拟复杂的自然景观。

  - 绘图方式

    从本质上讲，OpenGL绘图方式是由一系列的状态决定的，如果设置了一种状态或模式而不改变它，OpenGL在绘图过程中将一直保持这种状态或模式。

  - 工作流程

  - 基本步骤

    - 建模
    - 设置视点
    - 设置环境
    - 显示

### 3.4 图形变换

- 相机模型

  为了说明在3D物体到2D图像之间的变换，OpenGL引入了相机模型。

  视点变换：将相机置于三脚架上对准3D景物，调整视点位置，相当于视点变换。

  模型变换：将3D物体放在场景中的适当位置，相当于模型变换。

  投影变换：镜头调焦，确定视景体形状，相当于OpenGL的投影变换。

  视口变换：最后冲洗底片，决定2D相片的大小。

- 矩阵操作

- 视点变换

  视点变换是在视点坐标系中进行的。视点坐标系不同于物体所在的世界坐标系，它遵循左手法则，而世界坐标系遵循右手法则。

- 模型变换

  - 平移
  - 旋转
  - 缩放

- 投影变换

  经过模型变换后，场景中的物体被放在了所希望的位置上。但由于计算机智能显示2D图形，所以在表示3D图形时要靠投影将3D视景转换成2D视景，产生3D立体效果。其实质是定义一个视景体，裁减掉视景体外部分，最终进入图像的只是视景体内的部分。

  - 透视投影

    透视投影符合人们心理习惯，即离视点近的物体大，离视点远的物体小，远到极点即为消失，成为灭点。它的视景类似于一个顶部和底部都被切割过的棱锥，也就是棱台。这个投影通常用于动画、视觉仿真以及其他许多具有真实性反映的方面。

  - 正射投影

    正射投影，又叫平行投影。这种投影的视景体是一个长方体。

### 3.5 光照与材质

光照与材质处理是OpenGL绘制逼真3D图形的一个重要步骤，可以使物体具有较强的立体感。

- 光照模型

  简单的光照模型

  当光照射到一个物体的表面上时，会出现以下3种情形。

  - 光可以通过物体表面向空间反射，产生反射光。
  - 对于透明体，光可以穿透该物体并从另一端射出，产生透射光。
  - 部分光将被物体表面吸收而转换成热。

  反射光和透明光可以产生视觉效果。

  简单光照模型只考虑被照明物体表面的反射光影响，并假定物体表面光滑不透明且由理想材料构成，环境由白光照明。

  反射光分成3个分量：

  - 环境反射
  - 漫反射
  - 镜面反射

  OpenGL光组成：

  - 辐射光
  - 环境光
  - 漫射光
  - 镜面光

- 明暗处理

  在计算机图形学中，光滑的曲面表面常用多个小多边形予以逼近和表示，而每个小多边形的轮廓就用单一的颜色或许多不同的颜色来勾画或填充内部，这种处理方式称为明暗处理。

  用单一颜色处理的称为平面明暗处理，用许多不同颜色处理的称为光滑明暗处理。

- 材质

  1. 材质的含义

     OpenGL用材料对光的红、绿、蓝三原色的反射率来近似定义材料的颜色。像光源一样，材料颜色也分成环境、漫反射和镜面反射成分，它们决定了材料对环境光、漫反射光和镜面反射光的反射程度。

  2. 定义材质

  3. 更改材质

### 3.6 纹理映射

所谓纹理，可以简单理解为物体表面的花纹，就是应用到多边形上的图像。这些图像可以从文件中加载，或是在内存中生成。一旦将图像数据加载到了内存中，需要指定其为纹理映射来使用它。在3D图形中，纹理映射运用得很广，尤其是用于描述具有真实感的物体。另外，纹理映射能够保证在变换多边形时，多边形上的纹理图案也随之变化。纹理映射有许多情况，任意一块纹理可以映射到平面或曲面上，可按不同的方式映射到曲面上。

- 使用纹理对象

  纹理是一个OpenGL状态，通过glEnable(), glDisable()函数来实现开启和关闭。

  GL_TEXTURE_1D, GL_TEXTURE_2D, GL_TEXTURE_3D, GL_TEXTURE_CUBE_MAP

  1. 创建纹理对象
  2. 绑定纹理对象
  3. 删除纹理对象

- 指定纹理

  1. 定义一维纹理
  2. 定义二维纹理
  3. 创建三维纹理

- 纹理滤波

  将纹理映射到多边形上，实际上是将纹理的图像数据空间映射到帧缓冲图像空间上。所以，必须保证纹理图像加载完成。纹理图像被映射到多边形上可能会造成失真，所以需要加以适当的控制处理，如滤波处理。

  一般来说，纹理图像为正方形或长方形。当纹理图像映射到多边形上去时，屏幕上的一个点可能是纹理点的一部分，也有可能屏幕上的一个像素点是多个纹理的集合，即出现放大缩小现象。纹理过滤就是告诉OpenGL在纹理到屏幕像素点的映射中如何计算最终显示的图像数据。

- 设置映射方式

  可以用纹理中的值来调整多边形（或曲面）原来的颜色，或用纹理图像中的颜色与多边形原来的颜色进行混合。

- 生成纹理坐标

  1. 坐标定义

     在绘制纹理映射场景时，不仅要给每个顶点定义几何坐标，而且也要定义纹理坐标。

     经过多种变换后，几何坐标决定顶点在屏幕上绘制的位置，而纹理坐标决定纹理图像中哪一个纹素赋予该顶点。并且顶点之间的纹理坐标插值与基础篇中所讲的平滑着色插值方法相同。

     纹理图像是方形数组，纹理坐标通常可定义成1D、2D、3D、4D的形式，称为s，t，r，q坐标。

  2. 坐标自动产生

### 3.7 曲线和曲面

计算机图形学中，所有的光滑曲线、曲面都采用线段或**三角形逼近来模拟**，但为了精确的表现曲线，通常需要成千上万个线段或三角形来逼近，这种方法对于计算机的硬件资源有相当高的要求。然而，许多有用的曲线、曲面在数学上只需要用少数几个参数来描述。这种方法所需要的存储空间比线段、三角形逼近的方法所需要的空间小的多，并且**控制点方法**描述的曲线、曲面比线段、三角形逼近的曲线、曲面更精确。

OpenGL通过一种求值器的机制来产生曲线和曲面，该机制非常灵活，可以生成任意角度的多项式曲线，并可以将其他类型的多边形曲线和曲面转换成贝塞尔曲线和曲面。这些求值器能在任何度的曲线及曲面上计算指定数目的点。随后，OpenGL利用曲线和曲面上的点生成标准的OpenGL图元。

- 绘制曲线

- 构造曲面

  曲面的绘制方法基本上与曲线的绘制方法是相同的，所不同的是曲面使用2D求值器，并且将控制点连接起来形成一个网格。

- 图元逼近法绘制3D图形

  用来近似曲面的多边形最好选择三角形，因为**三角形的3个顶点在任何时候都位于同一平面内**，它一定是非常简单的非凹多边形，而四边形或其他多边形的顶点可能不在同一平面内，也就有可能不是简单多边形

  假设绘制一个球体，球体表面用很多个小三角形拼接而成，显然，用来近似球面的三角形越小，三角形越多，那么球面就越光滑。

### 3.8 颜色管理

几乎所有OpenGL应用目的都是在屏幕窗口内绘制彩色图形，所以颜色在OpenGL编程中占有很重要的地位。这里的颜色与绘画中的颜色概念不一样，它属于RGB颜色空间，只在显示器屏幕上显示。另外，屏幕窗口坐标是以像素为单位的，因此组成图形的每个像素都有自己的颜色，这种颜色值是通过对一系列OpenGL函数命令的处理最终计算出来的。

OpenGL颜色模式一共有RGB（RGBA）模式和颜色表模式两个。在RGB模式下，所有的颜色定义全部用R、G、B三个值来表示，有时也加上Alpha值。在颜色表模式下，每一个像素的颜色都是用颜色表中某个颜色索引值来表示，这样的表称为颜色映射。

- RGBA模式

  纹理映射只能在RGBA模式下进行。

- 颜色表模式



## 第4章 基于Direct3D的图形绘制

由于OpenGL只是一个图形函数库，随着多媒体技术的发展，其应用领域越来越受到限制。正是基于这个原因，Microsoft推出了全新的多媒体编程接口DirectX。

### DirectX概述

DirectX不仅支持图形/图像编程，而且支持声音、视频等，加之MS公司强势推广，DirectX从诞生之日就注定成为OpenGL的最大对手，并在用户之间引发了旷日持久的大论战。

- DirectX含义

  Direct eXtension。为“众多软件”提供“众多的”、“直接的”服务。

  DirectX本质上是一组API，由C++实现，遵循通用对象模式原则，为开发人员提供一个共同的硬件驱动标准，加强3D图形和声音效果，使以Windows为平台的游戏或多媒体程序获得更高的执行效率。

  DirectX俨然已成为游戏产业界的巨无霸，已成为了事实上的标准。

- DirectX结构

······



## 第6章 图像处理基础

### 6.1 概述

一般意义上的图像处理都是指数字图像处理。图像处理技术的主要内容包括图像压缩与编码、图像增强和复原、图像识别共3个部分。

- 图像处理

  所谓图像，是对各种图形和影像的总称。

  图像处理是信号处理理论在图像域上的一个具体应用。

- 数字图像

  数字图像又称数码图像或数位图像，可以理解为图像的数字表示，是时间和空间的非连续函数信号，是为了便于计算机处理的一种图像表现形式。数字图像在计算机内部被表示为一个数字矩阵，矩阵中每一元素称为像素。通过取样和量化过程，就可以将一个以自然醒时存在的模拟图像变换为适合计算机处理的数字形式。

  数字图像有很多固有特点。例如：图像信息量大。

  每个数字图像的像素通常对应于二维空间中一个特定的位置，并且有一个或者多个与该点相关的采样值组成数值。根据这些采样数目及特性的不同，数字图像可以划分为5类。

  - 二值图像

    Binary Image。每个像素不是黑就是白，其灰度值没有中间过渡的图像。

  - 灰度图像

    把“白-灰-黑”连续变化的灰度值量化为256个灰度级，则灰度值的范围为0～255，表示亮度从浅到深，对应图像中的颜色为从白到黑。

    显然，**由于灰度只有256级，因而在物体的边缘呈现灰度的不连续性，这就是图像分割的理论依据。**

  - 彩色图像

    - 真彩色图像

      每个像素都分成R、G、B三个颜色基量。

    - 伪彩色图像

      每个像素值实际上是一个索引值或代码，产生的颜色是真的，不过它不一定反映原图的色彩。

    - 索引图像

- 数字图像处理

  数字图像处理（DIgital Image Processing， DIP）是指通过计算机对图像进行去处噪声、增强、复原、分割、提取特征等处理的方法和技术。

  主要研究、解决以下3个基本问题：

  1. 寻求高效、实时、保真的图像压缩和编码技术，以便节省图像传输、处理时间和减少所占用的存储器容量。
  2. 为了提高图像质量，防止噪声干扰和图像退化，加强图像增强和图像复原理论的研究。
  3. 针对图像变换大多直接在空域进行因而计算量特别巨大的缺陷，寻求合适的图像变换理论与技术，如傅立叶变换、离散余弦变换、小波变换等，将空域处理转换为变换域处理，以求**大幅度减少计算量**。

  数字图像处理的研究方法

  1. 直接在空间域中处理图像。
  2. 在变换域中处理图像。
  3. 应用数学形态学运算处理图像。

- 图像文件格式

  























