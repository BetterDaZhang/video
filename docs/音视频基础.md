## 音视频基础

##### 转载——[[总结]视音频编解码技术零基础学习方法](http://blog.csdn.net/leixiaohua1020/article/details/18893769)

[雷霄骅(leixiaohua1020)的专栏](http://blog.csdn.net/leixiaohua1020)



#### 一、基本概念

- 封装格式：把视频数据和音频数据打包成一个文件的规范，如avi，flv，mp4，mkv等。不同的封装格式之间差距不大，各有优劣。有些封装格式支持的音视频编码标准很广泛如MKV，有些很少如RMVB。
- 音视频编码标准：音频编码标准包括AAC，MP3，AC-3等。视频的编码标准则包含H.264，MPEG2，VC-1等。

#### 二、视频播放器原理

​	音视频技术主要包括以下几点：封装技术，视频压缩编码技术和音频压缩编码技术。考虑到网络传输，还包括流媒体协议技术。

​	视频播放器播放一个互联网上的视频文件，需要经过一下几个步骤：解协议，解封装，解码音视频，音视频同步。

![](http://img.blog.csdn.net/20140201120523046?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVpeGlhb2h1YTEwMjA=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)

**解协议**就是将流媒体协议的数据解析为标准的相应的封装格式的数据。音视频在网上传播时常常采用各种流媒体协议，如HTTP，RTMP等。这些协议在传输音视频数据的同时，也会传输一些信令数据。这些信令数据包括对播放的控制（播放，暂停，停止），或者对网络状态的描述等。解协议的过程中会去除掉信令数据而至保留音视频数据。例如，采用RTMP协议传输的数据，经过解协议操作后，输出FLV格式的数据。

**解封装**的作用，就是将输入的封装格式的数据，分离成为音频流压缩编码数据和视频流压缩编码数据。封装的格式种类很多，例如MP4，MKV，RMVB，TS，FLV，AVI等，它的作用就是将已经压缩编码的视频数据和音频数据按照一定的格式放到一起。例如：FLV格式的数据，经过解封操作后，输出H.264编码的视频码流和AAC编码的音频码流。

**解码**的作用，就是将视频/音频压缩编码数据，解码成为非压缩的视频/音频原始数据。通过解码，压缩编码的视频数据输出成为非压缩的颜色数据，例如YUV420P，RGB等。压缩编码的音频数据输出成为非压缩的音频抽样数据，如PCM数据。

**音视频同步**就是根据解封装模块处理过程中获取到的参数信息，同步解码出来的视频和音频数据，并将视频音频数据送至系统的显卡和声卡播放出来。

#### 三、流媒体协议

| 名称       | 推出机构      | 传输层协议   | 客户端     | 目前使用领域   |
| -------- | --------- | ------- | ------- | -------- |
| RTSP+RTP | IETF      | TCP+UDP | VLC，WMP | IPTV     |
| RTMP     | Adobe     | TCP     | Flash   | 互联网直播    |
| RTMFP    | Adobe     | UDP     | Flash   | 互联网直播    |
| MMS      | Microsoft | TCP/UDP | WMP     | 互联网直播+点播 |
| HTTP     | WWW+IETF  | TCP     | Flash   | 互联网点播    |

RTSP+RTP经常用于IPTV领域，因为其采用的UDP传输音视频，支持组播，效率较高。但是网络不好时可能会丢包，影响视频观看质量。

互联网视频服务通常采用TCP作为其流媒体的传输层协议，使用RTMP，MMS，HTTP等。这类协议不会丢包，保证了视频的质量，但是传输效率会相对低一些。

#### 四、封装格式

| 名称   | 推出机构          | 流媒体  | 支持的视频编码                    | 支持的音频编码                           | 目前使用领域    |
| ---- | ------------- | ---- | -------------------------- | --------------------------------- | --------- |
| AVI  | Microsoft     | 不支持  | 几乎所有格式                     | 几乎所有格式                            | BT下载影视    |
| MP4  | MPEG          | 支持   | MPEG-2,MPEG-4,H.264,H.263等 | AAC，MPEG-1 Layers I，II，III，AC-3等  | 互联网视频网站   |
| TS   | MPEG          | 支持   | MPEG-1，MPEG-2，MPEG-4，H.264 | MPEG-1 Layers I，II，III，AAC        | IPTV，数字电视 |
| FLV  | Adobe         | 支持   | SOrenson，VP6，H.264         | MP3，ADPCM，Linear PCM，AAC等         | 互联网视频网站   |
| MKV  | CoreCodec     | 支持   | 几乎所有格式                     | 几乎所有格式                            | 互联网视频网站   |
| RMVB | Real Networks | 支持   | RealVideo 8，9，10           | AAC，Cook Codec，RealAudio Lossless | BT下载影视    |

除了AVI以外，其他封装格式都支持流媒体，即可以“边下边播”。

#### 五、视频编码

视频编码的主要作用是价格视频像素数据（RGB，YUV等）压缩成为视频码流，从而降低视频的数据量。如果视频不经过压缩的话，体积通常是非常大的，一部电影就需要上百G的空间。视频码流的数据量占了音视频总数据量的绝大部分。高效率的视频编码在同等的码率下，可以获得更高的视频质量。

当前使用最多的编码方案就是H.264。

| 名称          | 推出机构       | 推出时间 | 目前使用领域 |
| ----------- | ---------- | ---- | ------ |
| HEVC（H.265） | MPEG/ITU-T | 2013 | 研发中    |
| H.264       | MPEG/ITU-T | 2003 | 各个领域   |
| MPEG4       | MPEG       | 2001 | 不温不火   |
| MPEG2       | MPEG       | 1994 | 数字电视   |
| VP9         | Google     | 2013 | 研发中    |
| VP8         | Google     | 2008 | 不普及    |
| VC-1        | Microsoft  | 2006 | 微软平台   |



#### 六、音频编码

音频编码的主要作用就是将音频采样数据压缩成为音频码流，从而降低音频的数据量。一般情况下音频的数据量要远小于视频的数据量。高效率的音频编码在同等的码率下，可以获得更高的音质。

| 名称   | 推出机构      | 推出时间 | 目前使用领域  |
| ---- | --------- | ---- | ------- |
| AAC  | MPEG      | 1997 | 各个领域（新） |
| AC-3 | Dolby     | 1992 | 电影      |
| MP3  | MPEG      | 1993 | 各个领域（旧） |
| WMA  | Microsoft | 1999 | 微软平台    |

近年来并未推出全新的音频编码方案，可见音频编码技术已经基本可以满足人们的需要。音频编码技术近期绝大部分的改动都是在MP3的继任者——AAC的基础上完成的。

#### 七、现有网络音视频平台对比

直播服务普遍采用RTMP作为流媒体协议，FLV作为封装格式，H.264作为视频编码格式，AAC作为音频编码格式。 视频播放器使用Flash播放器。

点播服务普遍采用HTTP作为流媒体协议，H.264作为视频编码格式，AAC作为音频编码格式。采用HTTP作为点播协议的优势：1.HTTP是基于TCP协议的应用层协议，媒体传输过程不会出现丢包，保证了视频的质量；2.HTTP被绝大多数Web服务器支持。

点播服务采用的封装格式有多种：MP4，FLV，F4V等，它们之间的区别不是很大。视频编码标准和音频编码标准是H.264和AAC。这两种标准分别是当今实际应用中编码效率最高的视频标准和音频标准。视频播放器方面，无一例外的都使用了Flash播放器。



